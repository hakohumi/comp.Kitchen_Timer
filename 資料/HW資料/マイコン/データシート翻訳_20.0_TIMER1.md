# データシート翻訳 20.0 timer1

## 20.0 TIMER1 MODULE WITH GATE CONTROL

Timer1モジュールは、次の機能を備えた16ビットタイマー/カウンターです。
•16ビットタイマー/カウンターレジスタペア（TMR1H：TMR1L）
•プログラム可能な内部または外部クロックソース
•2ビットプリスケーラ
•専用の32 kHz発振回路
•オプションで同期されたコンパレータ出力
•複数のTimer1ゲート（カウントイネーブル）ソース
•オーバーフロー時の割り込み
•オーバーフロー時のウェイクアップ（外部クロック、
非同期モードのみ）
•キャプチャ/比較機能のタイムベース
•特別イベントトリガー（CCP / ECCPを使用）
•選択可能なゲートソース極性
•ゲートトグルモード
•ゲートシングルパルスモード
•ゲート値ステータス
•ゲートイベント割り込み
図20-1は、Timer1モジュールのブロック図です。

## 20.1 Timer1 Operation

Timer1モジュールは、TMR1H：TMR1Lレジスタペアを介してアクセスされる16ビットの増分カウンタです。
 TMR1HまたはTMR1Lに書き込むと、カウンターが直接更新されます。
 内部クロックソースで使用する場合、モジュールはタイマーであり、命令サイクルごとにインクリメントします。
 モジュールは、外部クロックソースと共に使用する場合、タイマーまたはカウンターとして使用でき、外部ソースの選択したエッジごとにインクリメントします。
 Timer1を有効にするには、T1CONおよびT1GCONレジスタのTMR1ONビットとTMR1GEビットをそれぞれ構成します。
 表20-1は、Timer1の有効な選択を示しています。

## 20.2 Clock Source Selection

T1CONレジスタのTMR1CS <1：0>およびT1OSCENビットを使用して、Timer1のクロックソースを選択します。
 表20-2に、クロックソースの選択を示します。

### 20.2.1 INTERNAL CLOCK SOURCE

内部クロックソースが選択されると、TMR1H：TMR1Lレジスタペアは、Timer1プリスケーラによって決定されるFOSCの倍数でインクリメントします。
 FOSC内部クロックソースが選択されている場合、Timer1レジスタの値は、命令クロックサイクルごとに4カウント増加します。
 この状態のため、Timer1の値を読み取るときに、解像度に2 LSBエラーが発生します。
 Timer1のフル解像度を利用するには、非同期入力信号を使用してTimer1クロック入力をゲートする必要があります。
 次の非同期ソースを使用できます。
•T1GピンのTimer1への非同期イベント
ゲート
•Timer1ゲートへのC1またはC2コンパレータ入力

### 20.2.2 EXTERNAL CLOCK SOURCE

外部クロックソースが選択されている場合、Timer1モジュールはタイマーまたはカウンターとして機能します。
 カウントを有効にすると、Timer1は、外部クロック入力T1CKIまたは容量性センシングオシレータ信号の立ち上がりエッジでインクリメントされます。
 これらの外部クロックソースは、マイクロコントローラーのシステムクロックに同期させることも、非同期で実行することもできます。
 クロック発振器を備えたタイマーとして使用する場合、外部32.768 kHz水晶を専用の内部発振器回路と組み合わせて使用​​できます。


注：カウンターモードでは、以下の1つ以上の条件が発生した後、最初にインクリメントする立ち上がりエッジの前に、立ち下がりエッジをカウンターで登録する必要があります。
•POR後に有効化されたTimer1
•TMR1HまたはTMR1Lへの書き込み
•Timer1が無効になっている
•Timer1が無効になっている（TMR1ON = 0）
T1CKIが高いと、T1CKIが低いとTimer1が有効になります（TMR1ON = 1）。

## 20.3 Timer1 Prescaler

Timer1には、クロック入力を1、2、4、または8分周できる4つのプリスケーラオプションがあります。
 T1CONレジスタのT1CKPSビットは、プリスケールカウンタを制御します。
 プリスケールカウンターは直接読み書きできません。ただし、プリスケーラカウンタは、TMR1HまたはTMR1Lへの書き込み時にクリアされます。


 ## 20.4 Timer1 Oscillator

T1OSI（入力）ピンとT1OSO（アンプ出力）ピンの間に、専用の低電力32.768 kHz発振回路が組み込まれています。
 この内部回路は、外部32.768 kHz水晶と組み合わせて使用​​されます。
T1CONレジスタのT1OSCENビットをセットすると、発振回路が有効になります。
 オシレータはスリープ中も動作し続けます。

注：発振器は使用前に起動と安定化時間を必要とします。
  したがって、Timer1を有効にする前に、T1OSCENを設定し、適切な遅延を監視する必要があります。


## 20.7 Timer1 Interrupt

Timer1レジスタペア（TMR1H：TMR1L）はFFFFhにインクリメントし、0000hにロールオーバーします。 Timer1がロールオーバーすると、PIR1レジスタのTimer1割り込みフラグビットがセットされます。ロールオーバー時の割り込みを有効にするには、次のビットを設定する必要があります。
•T1CONレジスタのTMR1ONビット
•PIE1レジスタのTMR1IEビット
•INTCONレジスタのPEIEビット
•INTCONレジスタのGIEビット
割り込みは、割り込みサービスルーチンのTMR1IFビットをクリアすることでクリアされます。


注：TMR1H：TMR1LレジスタペアとTMR1IFビットは、割り込みを有効にする前にクリアする必要があります。